<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>ComPay</title>

    <!-- Bootstrap -->
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js"></script>

    <link href="css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="css/whhg.css">
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<link href="CSS.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
     <div class = 'container'>
		      <div class = 'span2 col-md-1'></div>
		      <div class = 'span8 col-md-10' id = 'mainbox'>
				 <div class="btn btn-primary btn-group-justified disabled">АНАЛИЗ КОММУНАЛЬНЫХ ПЛАТЕЖЕЙ</div>				
				 <div class="btn-group btn-group-justified" role="group" aria-label="...">
                     <div class="btn-group" role="group">
                         <button type="button" class="btn btn-info"id="button_enter_data">ВВЕСТИ ПОКАЗАТЕЛИ</button>
                     </div>
                     <div class="btn-group" role="group">
                         <button type="button" class="btn btn-info" id="button_analiz">СРАВНЕНИЕ</button>
                     </div>               
                 </div>
				 <div id="page_enter_data">
				     <div class="btn-group" id="month-button">
                         <button type="button" class="btn btn-danger" id="month">Месяц</button>
                         <button type="button" class="btn btn-danger dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                         <span class="caret"></span>
                         <span class="sr-only">Toggle Dropdown</span>
                         </button>
                         <ul class="dropdown-menu month-list">
                            <li class="active"><a href="#">Январь</a></li>
                            <li><a href="#">Февраль</a></li>
                            <li><a href="#">Март</a></li>
                            <li><a href="#">Апрель</a></li>
							<li><a href="#">Май</a></li>
							<li><a href="#">Июнь</a></li>
							<li><a href="#">Июль</a></li>
							<li><a href="#">Август</a></li>
							<li><a href="#">Сентябрь</a></li>
							<li><a href="#">Октябрь</a></li>							
							<li><a href="#">Ноябрь</a></li>
							<li><a href="#">Декабрь</a></li>						
                         </ul>
                 </div>
				     <div class="btn-group" id="year-button">
                         <button type="button" class="btn btn-danger" id="year">Год</button>
                         <button type="button" class="btn btn-danger dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                         <span class="caret"></span>
                         <span class="sr-only">Toggle Dropdown</span>
                         </button>
                         <ul class="dropdown-menu year-list">
                            <li><a href="#">2013</a></li>
                            <li><a href="#">2014</a></li>
                            <li class="active-year"><a href="#">2015</a></li>
                            <li><a href="#">2016</a></li>
                            <li><a href="#">2017</a></li>                      					
                         </ul>
                 </div>
				 <div class="row" id="data-window">
				     <div id="input-counter" class="col-md-4 col-xs-4">
				     <div class="input-group">
                        <span class="input-group-addon" id="basic-addon1">Газ</span>
                        <input type="number" class="form-control enter1" placeholder="Пред. пок" aria-describedby="basic-addon1">
                     </div>
					 <div class="input-group">
                        <span class="input-group-addon" id="basic-addon2">Електр.</span>
                        <input type="number" class="form-control enter2" placeholder="Пред. пок" aria-describedby="basic-addon1">
                     </div>
					 <div class="input-group">
                        <span class="input-group-addon" id="basic-addon3">Вода</span>
                        <input type="number" class="form-control enter3" placeholder="Пред. пок" aria-describedby="basic-addon1">
                     </div>
			         </div>
			        <div id="input-pot" class="col-md-4 col-xs-4">
			        	<div class="input-group">
			               <input type="number" class="form-control pot enter4" id="" placeholder="Пот. пок" >
			            </div>
			            <div class="input-group">
			               <input type="number" class="form-control pot enter5" id="" placeholder="Пот. пок">
			            </div>
			            <div class="input-group">
			               <input type="number" class="form-control pot enter6" id="" placeholder="Пот. пок">
			            </div>   
				    </div>
				    
				    <div id="input-tariff" class="col-md-4 col-xs-4">
				     <div class="input-group">
				         <span class="input-group-addon" id="basic-addon6">тариф</span>
						 <input type="text" class="form-control tar1" placeholder="" value="7.18" aria-describedby="basic-addon1">
					 </div>
                     <div class="input-group">
				         <span class="input-group-addon" id="basic-addon7">тариф</span>
						 <input type="text" class="form-control tar2" placeholder="" value="0.36" aria-describedby="basic-addon1">
					 </div>
                     <div class="input-group">
				         <span class="input-group-addon" id="basic-addon8">тариф</span>
						 <input type="text" class="form-control tar3" placeholder="" value="8.26" aria-describedby="basic-addon1">
					 </div>	
                     <div class="input-group">
				         <span class="input-group-addon" id="basic-addon9">ОСББ</span>
						 <input type="text" class="form-control tar4" placeholder="" value="93.18" aria-describedby="basic-addon1">
					 </div>						 
					 <div class="input-group">
				         <span class="input-group-addon" id="basic-addon10">Мусор</span>
						 <input type="text" class="form-control tar5" placeholder="" value="12.00" aria-describedby="basic-addon1">
					 </div>	    
				    </div>
				 </div>
				     <div class="row">
				     <div class="col-md-8 col-xs-8">
				         <button type="button" class="btn btn-danger" id="send-data" data-toggle="tooltip" data-placement="right" title="Tooltip on right">Принять</button>
				         <div class="alert alert-danger tooltip_empty" role="alert" hidden>Введите поточные показатели</div>
				         <div class="alert alert-danger tooltip_comparison" role="alert" hidden>Поточные меньше предыдущих</div>
				     </div>

					 <div class="col-md-4 col-xs-4">
						 <input type="text" class="form-control" id="rezult" placeholder="Итого">
				     </div>
			     </div>
			     </div>
			     <div id="page_analiz" hidden>
				     <div class="row row_analiz">
					     <div class="col-md-3 col-xs-3 col_analiz" id="col_month">			     
							 <button type="button" class="btn btn-danger btn-group-justified disabled" disabled="disabled">Месяц</button>
							 				 
						 </div>
						 <div class="col-md-3 col-xs-3 col_analiz" id="col_gas">
						     <button type="button" class="btn btn-danger btn-group-justified disabled" disabled="disabled">Газ</button>
							 
						 </div>
						 <div class="col-md-3 col-xs-3 col_analiz" id="col_electr">
						     <button type="button" class="btn btn-danger btn-group-justified disabled" disabled="disabled">Електр.</button>
							 
						 </div>
						 <div class="col-md-3 col-xs-3 col_analiz" id="col_water">
						     <button type="button" class="btn btn-danger btn-group-justified disabled" disabled="disabled">Вода</button>
							 
						 </div>
					 </div>
				 </div>
			  </div>
			  <div class = 'span2 col-md-1'></div>
		</div>
	 </div>
     <script>
	  (function(){
	     //Переключение между окнами
		 $('#button_enter_data').click(function(){
		     $('#page_enter_data').show();
			 $('#page_analiz').hide();
		 });
		 $('#button_analiz').click(function(){
		     $('#page_enter_data').hide();
			 $('#page_analiz').show();
		 });
		 $('#button_total').click(function(){
		     $('#page_enter_data').hide();
			 $('#page_analiz').hide();
		 });
		 // Окно ввода данных
		 (function currentDate(){
		     var date = new Date();
		     var curent_year = date.getFullYear();
		     //var prev_month = date.getMonth()-1;
			 function getCurrentMonth(){
			     var months = ['Январь','Февраль','Март','Апрель','Май','Июнь','Июль','Август','Сентябрь','Октябрь','Ноябрь','Декабрь']
			     //return months[prev_month];
				 return months[0];
			 };
			 $('#year').text(curent_year);
			 $('#month').text(getCurrentMonth());
	         console.log();
		 })();	
		 //	 		 
		 $('.month-list li').click(function(){ // Подстановка предыдущего месяца
		     var month = $('#month');
			 var txt = $(this).text();
			 $('.month-list li').removeClass('active');
			 $(this).addClass('active');
			     month.text(txt);
				 $('input[type=number]').val('');
				 $('#rezult').val('');
				 if(txt == "Май" || txt == "Июнь" || txt == "Июль" || txt == "Август" || txt == "Сентябрь"){
				     $('.tar1').val('4.11');
				 }else{
				     $('.tar1').val('7.18');
				 }
		 })
		 //
		 $('.year-list li').click(function(){ // Подстановка текущего года
		     var year = $('#year');
			 var txt = $(this).text();
			     $('.year-list li').removeClass('active-year');
			     $(this).addClass('active-year');
			     year.text(txt);
		 });
		 //

		 //	  		 
		 $('input[type=number]').bind('change',function(){ // Подсчет оплаты за данный месяц				 		 
			 var sum = function(){
			     var gas = $('.enter4').val() - $('.enter1').val();
				 var el = $('.enter5').val() - $('.enter2').val();
				 var water = $('.enter6').val() - $('.enter3').val();
				 
				 var tar_gas = $('.tar1').val();
				 var tar_el = $('.tar2').val();
				 var tar_water = $('.tar3').val();
				 var tar_osbb = $('.tar4').val();
				 var tar_garb = $('.tar5').val();
				 return gas*tar_gas + el*tar_el + water*tar_water + tar_osbb*1 + tar_garb*1;
			 }	 
			 sum = sum().toFixed(2);			 
			 if($('.enter4').val() == '' && $('.enter5').val() == '' && $('.enter6').val() == ''){
			     $('#rezult').val('');
			 }else if(+$('.enter4').val() < +$('.enter1').val() || +$('.enter5').val() < +$('.enter2').val() || +$('.enter6').val() < +$('.enter3').val()){
                 $('#rezult').val('');
			 }else{
			     $('#rezult').val(sum +' грн');
			 }			 
	     });
	     //
		 var getArray =[];
         var array_gas = [];
         var array_electr = [];
         var array_water = []; 
         //

         //$('.tooltip_send').hide());     
		 $('#send-data').click(function(){// Создание массива с данными по месяцах и добавление в массив getArray
		    if($('.enter4').val() == '' && $('.enter5').val() == '' && $('.enter6').val() == ''){
             $('.tooltip_empty').show();
             $('#send-data').mouseleave(function(){
             	$('.tooltip_empty').hide();
             });
		    }else if(+$('.enter4').val() < +$('.enter1').val() || +$('.enter5').val() < +$('.enter2').val() || +$('.enter6').val() < +$('.enter3').val()){
                $('.tooltip_comparison').show();
                $('#send-data').mouseleave(function(){
                    $('.tooltip_comparison').hide();	
		        });
		    }else{ 		     
			 function pushIngetArray(){	// создание массива из значений инпутов	 	     
			     var curent_month_indicators = [];
				 var current_month = $('button#month').text();
			     var current_year = $('button#year').text();
			     var input_value_pred = $('[placeholder="Пред. пок"]');
			     var input_value_pot = $('[placeholder="Пот. пок"]');	
                 var tar_gas = $('.tar1').val() * ($('[placeholder="Пот. пок"]')[0].value - $('[placeholder="Пред. пок"]')[0].value);
				 var tar_el = $('.tar2').val() * ($('[placeholder="Пот. пок"]')[1].value - $('[placeholder="Пред. пок"]')[1].value);
				 var tar_water = $('.tar3').val() * ($('[placeholder="Пот. пок"]')[2].value - $('[placeholder="Пред. пок"]')[2].value);				 
					 for(i=0; i<input_value_pred.length; i++){
				         curent_month_indicators[i] = input_value_pot[i].value - input_value_pred[i].value;  
				     }
                 curent_month_indicators.unshift(current_year, current_month);
                 curent_month_indicators.push(tar_gas, tar_el, tar_water); 				 
				 //getArray.push(curent_month_indicators);
				 return curent_month_indicators;

			 };

			 function checkArray(arr){ // проверка массива на совпадение элументов
			     for( var i = 0; i<arr.length; i++){
				     var val = arr[i];
					 if(pushIngetArray()[1] == val[1] && pushIngetArray()[0] == val[0]){// проверка совпадения месяца и года
						 return arr.indexOf(val); 
					 }else{
						 continue;  
					 }
				 }	
			 }	 			 			 
			 if(getArray.length >= 1){ // добавление или замена элементов в массиве getArray
			     checkArray(getArray);
				 if(checkArray(getArray) >= 0){
				     getArray.splice(checkArray(getArray), 1, pushIngetArray());  //checkArray(getArray) = pushIngetArray();
				 }else{
				     getArray.push(pushIngetArray());
				 }
			 }else{
			     getArray.push(pushIngetArray());
			 }			 			 
			 for(i = 0; i < getArray.length; i++){ // добавление в отдельные массивы значений счетчиков
			     var val = getArray[i];				 
				 array_gas.push(val[2]);
				 array_electr.push(val[3]);
				 array_water.push(val[4]);
			 };
			 function nextMonth(){// При нажатии на Принять меняется Месяц на следующий
		 	     //var current_month = $('.month-list .active');
		 	     //var current_year = $('.year-list .active-year');
		 	     var next_month = $('.month-list .active').next();
		 	     var next_year = $('.year-list .active-year').next();
		 	     var month = $('#month');
		 	     var year = $('#year');
		 	     $('.month-list li').removeClass('active');		     
			     if(next_month.text() !== ''){
			     	next_month.addClass('active');
                    month.text(next_month.text());
			     }else{
			     	next_month = $('.month-list li:first-child').addClass('active');
			     	month.text(next_month.text());
			     	
			     	if(next_year.text() !== ''){
			     	   $('.year-list li').removeClass('active-year');
                       next_year.addClass('active-year');
                       year.text(next_year.text());
			     	}else{
			     	   return;
			     	}		     	
			     }     		 	
		     };
		     function fromPotInPrev(){// Поточные показатели для след. месяца попадают в предыдущие
				 var pred_gas = $('.enter1');
				 var pred_el = $('.enter2');
				 var pred_water = $('.enter3');
                 pred_gas.val($('.enter4').val());
                 pred_el.val($('.enter5').val());
                 pred_water.val($('.enter6').val());
                 $('[placeholder="Пот. пок"]').val('');
                 $('#rezult').val('');
		     };
		     fromPotInPrev();				            		
			 nextMonth();
			 function arraySum(arr){ //Общий счетчик за период времени 
			 	  var rezult = [],
			 	  sumgas = 0,
			 	  sumel = 0,
			 	  sumwater = 0,
			 	  sumgrngas = 0,
			 	  sumgrnel = 0,
			 	  sumgrnwater = 0;
                  for(i=0; i<arr.length; i++){
                  	var val = arr[i]; 
                    sumgas += val[2];
                    sumel += val[3];
                    sumwater += val[4];
                    sumgrngas += val[5];
                    sumgrnel += val[6];
                    sumgrnwater += val[7];
                  }
                  rezult.push(sumgas, sumel, sumwater, sumgrngas, sumgrnel, sumgrnwater);
                  return rezult;
			 };
             arraySum(getArray);
	         var max_gas = Math.max.apply(null, array_gas );
		     var max_electr = Math.max.apply(null, array_electr );
		     var max_water = Math.max.apply(null, array_water );
			 var min_gas = Math.min.apply(null, array_gas );
		     var min_electr = Math.min.apply(null, array_electr );
		     var min_water = Math.min.apply(null, array_water );
			 function createDivs(arr){ // очистка и добавление новых эл. с массива getArray в страницу сравнения
			         $('.del').remove();
					 for(i=0; i<arr.length; i++){
			         var value = arr[i];
					 //
					 $('#col_month').append('<div class="alert alert-info del"></div>');
					 $('#col_month > div:empty').append(value[1]+' / '+value[0]);	
					 //
					 if(value[2] == max_gas){
					     $('#col_gas').append('<div class="alert alert-danger del"></div>');
					 }else if(value[2] == min_gas){
					     $('#col_gas').append('<div class="alert alert-success del"></div>');
					 }else{
					     $('#col_gas').append('<div class="alert alert-info del"></div>');
					 };					 
					 $('#col_gas > div:empty').append(value[2]*1 + " м.куб" + " / " + value[5].toFixed(2) + " грн");				 					
					 //
					 if(value[3] == max_electr){
					     $('#col_electr').append('<div class="alert alert-danger del"></div>');
					 }else if(value[3] == min_electr){
					     $('#col_electr').append('<div class="alert alert-success del"></div>');
					 }else{
					     $('#col_electr').append('<div class="alert alert-info del"></div>');
					 }			 
					 $('#col_electr > div:empty').append(value[3]*1 + " к.вт" + " / " + value[6].toFixed(2) + " грн");					  
					 //
					 if(value[4] == max_water){
					     $('#col_water').append('<div class="alert alert-danger del"></div>');
					 }else if(value[4] == min_water){
					     $('#col_water').append('<div class="alert alert-success del"></div>');
					 }else{
					     $('#col_water').append('<div class="alert alert-info del"></div>');
					 }					 
					 $('#col_water > div:empty').append(value[4]*1 + " м.куб" + " / " + value[7].toFixed(2) + " грн");				 			         
					 };
					 
					 $('#col_month').append('<div class="alert alert-info del"></div>');
					 $('#col_month > div:empty').append('Итого');					
					 $('#col_gas').append('<div class="alert alert-info del total"></div>');
					 $('#col_gas > div.total').append(arraySum(getArray)[0] + " м.куб"+ " / " +arraySum(getArray)[3]+  " грн");
					 $('#col_electr').append('<div class="alert alert-info del total"></div>');
					 $('#col_electr > div.total').append(arraySum(getArray)[1] + " к.вт"+ " / " +arraySum(getArray)[4]+  " грн");	
					 $('#col_water').append('<div class="alert alert-info del total"></div>');
					 $('#col_water > div.total').append(arraySum(getArray)[2] + " м.куб"+ " / " +arraySum(getArray)[5]+  " грн");
			 };	         
			 
			 createDivs(getArray);
			 
			 
			 
			 //console.log(array_gas);
			 console.log(getArray[0],getArray[1],getArray[2],getArray[3],getArray[4],getArray[5]);
			 //console.log(pushIngetArray());
			 //console.log(get_i);
			}
			 })        		 
	  })();
	 </script>
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
  </body>
</html>